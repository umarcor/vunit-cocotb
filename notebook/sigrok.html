

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sigrok-cli | Pulseview &mdash; Open Source Verification Bundle latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/osvb.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Fixed-point conversion" href="fpconv.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logow.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/frameworks.html">Frameworks and Methodologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/sim.html">Simulators | Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/cosim.html">Co-simulation</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apis/core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/project.html">Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/tool.html">Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/runner.html">Runner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/logging.html">Logging</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../egs/sff.html">Simple Flip-Flop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../egs/axi4stream.html">SISO AXI4 Stream</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="fpconv.html">Fixed-point conversion</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">sigrok-cli | Pulseview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#required-enhancements-and-possible-workarounds">Required enhancements and possible workarounds</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nested-signal-groups">Nested signal groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#value-logic-signals">9-value logic signals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance">Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-waveform-formats">Other waveform formats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#generating-waveforms-with-ghdl">Generating waveforms with GHDL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#resolution">Resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hierarchy">Hierarchy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Open Source Verification Bundle</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
            

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>sigrok-cli | Pulseview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/umarcor/osvb/blob/master/doc/notebook/sigrok.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sigrok-cli-pulseview">
<span id="osvb-notebook-sigrok"></span><h1>sigrok-cli | Pulseview<a class="headerlink" href="#sigrok-cli-pulseview" title="Permalink to this headline">¶</a></h1>
<p>This section contains notes about reading waveforms from HDL simulators with <a class="reference external" href="https://sigrok.org/wiki/Sigrok-cli">sigrok-cli</a> and <a class="reference external" href="https://sigrok.org/wiki/PulseView">PulseView</a> (see <a class="reference external" href="https://github.com/sigrokproject">github.com/sigrokproject</a>).</p>
<p>While <a class="reference external" href="https://github.com/sigrokproject/pulseview">PulseView</a> is primarily meant for data captured from real devices (logic analyzers, oscilloscopes, multimeters, and more), some of its features can be useful for simulation and verification of hardware description designs. Precisely, <a class="reference external" href="https://sigrok.org/wiki/Protocol_decoders">protocol decoders</a> are a nice feature to complement Verification Components (e.g. Vunit’s <a class="reference external" href="http://vunit.github.io/verification_components/user_guide.html">VCL</a>), Bus Functional Models (BFMs) and/or monitors. Apart from vendor products, in-house custom protocol decoders can be used as a definition of the internal APIs. Moreover, analog signal visualization can be useful to show digital words that are meant to be used as inputs to DACs. Actually, mixed-signal cosimulations (as when combining GHDL and Xyce) produce both digital and analog traces.</p>
<p>The most widespread waveform format used by EDA tools is VCD: <a class="reference external" href="https://en.wikipedia.org/wiki/Value_change_dump">wikipedia.org/wiki/Value_change_dump</a>. However, not all VHDL types can be represented in VCD files. <a class="reference external" href="https://github.com/ghdl/ghdl">GHDL</a> supports a format named GHW, which is meant to dump traces from VHDL simulations. Visualization of any of these types (and others) is supported by <a class="reference external" href="http://gtkwave.sourceforge.net/">GtkWave</a>.</p>
<p>The file format that PulseView uses internally is <a class="reference external" href="https://sigrok.org/wiki/File_format:Sigrok">sigrok.org/wiki/File_format:Sigrok</a>. Hence, any other waveform needs to be converted, and possibly filtered. Currently supported input/output formats are listed at <a class="reference external" href="https://sigrok.org/wiki/Input_output_formats">sigrok.org/wiki/Input_output_formats</a>.</p>
<p>Sticking to VCD, several features are (unfortunately) currently missing in <a class="reference external" href="https://github.com/sigrokproject/libsigrok">libsigrok</a> and PulseView:</p>
<ul class="simple">
<li><p>Arrays of signals, i.e. multi-bit signals, are not supported.</p></li>
<li><p>Hierarchy of modules is not preserved.</p></li>
<li><p>By design, signal type is <cite>boolean</cite> (0 or 1).</p></li>
<li><p>They cannot handle huge dumps. While fast and responsive with time resolutions in the order of ms, us or ns, they have a hard time with ps or fs. These values are uncommon in physical capture devices, but relatively frequent in hardware modelling.</p></li>
<li><p>Waveform formats other than VCD are not supported.</p></li>
</ul>
<p>Fortunately, there is work in progress by user <cite>gsi</cite>, for improving and extending the VCD frontend in libsigrok. See <cite>wip/vcd-*</cite> branches in <a class="reference external" href="https://repo.or.cz/libsigrok/gsi.git/refs">repo.or.cz/libsigrok/gsi.git/refs</a>.</p>
<div class="section" id="required-enhancements-and-possible-workarounds">
<h2>Required enhancements and possible workarounds<a class="headerlink" href="#required-enhancements-and-possible-workarounds" title="Permalink to this headline">¶</a></h2>
<div class="section" id="nested-signal-groups">
<h3>Nested signal groups<a class="headerlink" href="#nested-signal-groups" title="Permalink to this headline">¶</a></h3>
<p>Although multi-bit signals are not supported yet, the concept of signal groups exists in PulseView. This is used to group 1-bit signals that belong to the same interface. Currently, PulseView picks channel groups from file imports other than VCD or from acquisition device drivers. At the same time, the VCD import frontend of libsigrok can generate nested channel groups.
Hence, PulseView should pick up and display the groups transparently. The main remaining question is whether the internal infrastructure of libsigrok supports nested groups.</p>
<p>Should nested groups be supported, three different types can be generated:</p>
<ul class="simple">
<li><p>level-0: multi-bit signals, i.e. groups of 1-bit signals that can be represented as a binary array, as an unsigned/signed decimal, as an hexadecimal value, etc. Moreover, any multi-bit signal can be optionally shown as an analog channel. This is specially useful for fixed-point types (in VHDL, <cite>sfixed</cite> and <cite>ufixed</cite>). For reference, GtkWave supports almost all of these features; however, displaying fixed-point values as analog channels has some limitations (see <a class="reference external" href="https://github.com/gtkwave/gtkwave/issues/9">gtkwave/gtkwave#9</a>).</p></li>
<li><p>level-1 and above: hierarchy of the design, according to the structure of HDL sources. This is described in VCD through <cite>scope module</cite>.</p></li>
<li><p>within a hierarchy level: nested groups of multi-bit signals would allow to describe interfaces such as Wishbone, AXI, or Avalon. Hence, protocol decoders could be written and used to display nice labels on top of them. However, this is typically done through naming conventions, so generation of these groups should probably be handled in PulseView and not in the VCD frontend.</p></li>
</ul>
<p>The in-progress VCD import frontend can parse scopes and generate signal names with dot separated labels in their names. This feature can be used to extract the hierarchy for visualization purposes.</p>
<p>Regarding visualization, it is currently not possible to collapse groups of multi-bit signals (not even level-0 groups). Ideally, a collapsible tree view or anchors would be shown.</p>
<p>At the moment, a possible workaround for level-0 groups is to create dummy <cite>integer</cite> or <cite>real</cite> signals in the HDL design, and convert multi-bit signals (in VHDL, <cite>to_integer</cite> and <cite>to_real</cite> can be used). However, this is not desirable, as it requires additional coding for each signal to be visualized.</p>
</div>
<div class="section" id="value-logic-signals">
<h3>9-value logic signals<a class="headerlink" href="#value-logic-signals" title="Permalink to this headline">¶</a></h3>
<p>In hardware description projects, types such as <cite>std_logic</cite> or <cite>std_logic_vector</cite> are very common. These are 9-value enumeration types, as opposed to <cite>boolean</cite>. Unfortunately, sigrok and PulseView are built around <cite>boolean</cite> values. Changing it is a non-trivial enhancement that might have many unexpected consequences.</p>
<p>The in-progress VCD import frontend converts values such as <cite>U</cite> to zero. This allows to import waveforms without crashing. However, reliability of protocol decoders is doubtful in these contexts. Users should implement alternative solutions to check the stability and strengh of signals.</p>
</div>
<div class="section" id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h3>
<p>Compared to GtkWave, PulseView has serious issues to handle wavefroms with small time scales. For example, the following waveform requires several seconds to load:</p>
<div class="highlight-vcd notranslate"><div class="highlight"><pre><span></span>$timescale
  1 ps
$end
$scope module tb $end
$var reg 1 ! clk $end
$upscope $end
$enddefinitions $end
#0
0!
#1000000000
1!
#2000000000
0!
#3000000000
1!
#4000000000
0!
#5000000000
1!
</pre></div>
</div>
<p>And the following, which is the same wave with a smaller scale, produces a crash:</p>
<div class="highlight-vcd notranslate"><div class="highlight"><pre><span></span>$timescale
  1 fs
$end
$scope module tb $end
$var reg 1 ! clk $end
$upscope $end
$enddefinitions $end
#0
0!
#1000000000000
1!
#2000000000000
0!
#3000000000000
1!
#4000000000000
0!
#5000000000000
1!
</pre></div>
</div>
<p>More than 9G of RAM are used, it takes minutes to load the first ~50 us, and in the end it is frozen.</p>
<p>As a workaround, both libsigrok and PulseView allow downsampling when VCD files are imported. It is also possible to <em>skip samples until timestamp</em> or to <em>compress idle periods</em>. These features should allow to avoid crashes with simulations that last milliseconds or seconds with clock frequencies of MHz.</p>
<p>Moreover, GHDL’s <em>mcode</em> backend allows to set the base time resolution of the simulation. See <a class="reference external" href="https://ghdl.github.io/ghdl/using/InvokingGHDL.html#cmdoption-ghdl-time-resolution" title="(in GHDL v2.0.0-dev)"><code class="xref std std-option docutils literal notranslate"><span class="pre">--time-resolution</span></code></a> examples in subdir <a class="reference external" href="https://github.com/umarcor/osvb/blob/master/sigrok/resolution">sigrok/resolution</a>.</p>
</div>
<div class="section" id="other-waveform-formats">
<h3>Other waveform formats<a class="headerlink" href="#other-waveform-formats" title="Permalink to this headline">¶</a></h3>
<p>In the wiki page about VCD, there are references to other waveform formats supported by GtkWave: <a class="reference external" href="https://sigrok.org/wiki/File_format:Vcd">sigrok.org/wiki/File_format:Vcd</a>. However, EVCD, FST, IDX and GHW are not explicitly documented. Hence, formats other than VCD are unlikely to be supported in libsigrok/PulseView in the near future. In the mid-long term, it would be nice if PulseView provided a frontend compatible with GtkWave’s utils/internals for handling large waveforms. It seems that GtkWave implements some clever memory map traversal to avoid handling the entire file in memory.</p>
<p>Information is available in:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://gtkwave.sourceforge.net/gtkwave.pdf">GtkWave User’s Guide</a> and GtkWave’s codebase.</p></li>
<li><p>GHDL’s codebase.</p></li>
<li><p><a class="reference external" href="https://github.com/nturley/ghw-notes">nturley/ghw-notes</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="generating-waveforms-with-ghdl">
<h2>Generating waveforms with GHDL<a class="headerlink" href="#generating-waveforms-with-ghdl" title="Permalink to this headline">¶</a></h2>
<p>In this section waveform dump features of GHDL are introduced. This is a complement to the information available in the docs: <a class="reference external" href="https://ghdl.github.io/ghdl/using/Simulation.html#export-waves" title="(in GHDL v2.0.0-dev)"><span>Export waveforms</span></a>. The purpose of these examples is to provide a test suite that allows users to evaluate the features and performance of upstream and in-progress branches.</p>
<div class="section" id="resolution">
<h3><a class="reference external" href="https://github.com/umarcor/osvb/blob/master/sigrok/resolution">Resolution</a><a class="headerlink" href="#resolution" title="Permalink to this headline">¶</a></h3>
<p>GHDL’s management of the time resolution during simulation is different depending on the backend. With LLVM or GCC, the resolution is <cite>1 fs</cite>, and so is the timescale of the resulting VCD files. It cannot be modified, because the time scale needs to be global. However, with mcode, GHDL automatically adjusts the resolution to the smallest time unit in the design. Furthermore, CLI option <a class="reference external" href="https://ghdl.github.io/ghdl/using/InvokingGHDL.html#cmdoption-ghdl-time-resolution" title="(in GHDL v2.0.0-dev)"><code class="xref std std-option docutils literal notranslate"><span class="pre">--time-resolution</span></code></a> allows to override it. Subdir <a class="reference external" href="https://github.com/umarcor/osvb/blob/master/sigrok/resolution">sigrok/resolution</a> contains three testbenches and a shell script to generate 15 waveforms with different time resolutions (12 with mcode and 3 with LLVM). Each waveform is saved to 5 different file formats, so 75 files are generated.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 50%" />
<col style="width: 14%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>backend</p></th>
<th class="head"><p>design</p></th>
<th class="head"><p>CLI</p></th>
<th class="head"><p>VCD</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mcode</p></td>
<td><p>ns</p></td>
<td><p>auto</p></td>
<td><p>ns</p></td>
</tr>
<tr class="row-odd"><td><p>mcode</p></td>
<td><p>us</p></td>
<td><p>auto</p></td>
<td><p>us</p></td>
</tr>
<tr class="row-even"><td><p>mcode</p></td>
<td><p>ms</p></td>
<td><p>auto</p></td>
<td><p>ms</p></td>
</tr>
<tr class="row-odd"><td><p>mcode</p></td>
<td><p>ns or us or ms</p></td>
<td><p>ps</p></td>
<td><p>ps</p></td>
</tr>
<tr class="row-even"><td><p>mcode</p></td>
<td><p>ns or us or ms</p></td>
<td><p>ns</p></td>
<td><p>ns</p></td>
</tr>
<tr class="row-odd"><td><p>mcode</p></td>
<td><p>us or ms</p></td>
<td><p>us</p></td>
<td><p>us</p></td>
</tr>
<tr class="row-even"><td><p>mcode</p></td>
<td><p>ms</p></td>
<td><p>ms</p></td>
<td><p>ms</p></td>
</tr>
<tr class="row-odd"><td><p>LLVM</p></td>
<td><p>ns or us or ms</p></td>
<td></td>
<td><p>fs</p></td>
</tr>
</tbody>
</table>
<p>where:</p>
<ul class="simple">
<li><p>backend: used GHDL backend.</p></li>
<li><p>design: smallest time unit in the design.</p></li>
<li><p>CLI: time resolution argument.</p></li>
<li><p>VCD: resulting time scale in the VCD.</p></li>
</ul>
</div>
<div class="section" id="hierarchy">
<h3><a class="reference external" href="https://github.com/umarcor/osvb/blob/master/sigrok/hierarchy">Hierarchy</a><a class="headerlink" href="#hierarchy" title="Permalink to this headline">¶</a></h3>
<p>libsigrok does currently not support nested name spaces (<cite>module</cite> keyword). This example generates a waveform from a testbench with an instantiated entity. The waveform includes such <cite>module</cite> keywords. The waveform can be loaded in PulseView without errors, but all the signals are flattened; so, the hierarchy is lost.</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Other FOSS alternatives exist for visualization of HDL simulation waveforms, but AFAIA, none of them is as complete as GtkWave and PulseView (each on a different area):</p>
<ul class="simple">
<li><p><a class="reference external" href="https://wavedrom.com/">wavedrom.com</a>, <a class="reference external" href="https://github.com/wavedrom/vcd">wavedrom/vcd</a> and <a class="reference external" href="https://github.com/wavedrom/zoom">zoom</a>.</p></li>
<li><p><a class="reference external" href="https://github.com/Nic30/d3-wave">Nic30/d3-wave</a></p></li>
<li><p><a class="reference external" href="https://github.com/raczben/fliplot">raczben/fliplot</a></p></li>
<li><p>LaTeX’s <a class="reference external" href="https://www.ctan.org/pkg/tikz-timing">tikz-timing</a>?</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="fpconv.html" class="btn btn-neutral float-left" title="Fixed-point conversion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Unai Martinez-Corral and contributors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/buildthedocs/sphinx.theme">theme</a>
    
    provided by <a href="https://buildthedocs.github.io">Build the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>