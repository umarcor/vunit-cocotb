

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fixed-point conversion &mdash; Open Source Verification Bundle latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/osvb.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="sigrok-cli | Pulseview" href="sigrok.html" />
    <link rel="prev" title="SISO AXI4 Stream" href="../egs/axi4stream.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logow.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/frameworks.html">Frameworks and Methodologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/sim.html">Simulators | Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/cosim.html">Co-simulation</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apis/core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/project.html">Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/tool.html">Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/runner.html">Runner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/logging.html">Logging</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../egs/sff.html">Simple Flip-Flop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../egs/axi4stream.html">SISO AXI4 Stream</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fixed-point conversion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initial-code-porting">Initial code porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-simulation-data">Getting simulation data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#waveform-dumps">Waveform dumps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vcd-parser">vcd_parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ghdl">GHDL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gtkwave">GtkWave</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sigrok-pulseview">sigrok/PulseView</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dwfv">dwfv</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vhdl-component-module">VHDL component/module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation-verification-frameworks">Simulation/verification frameworks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analyzing-simulation-statistics">Analyzing simulation statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#suggesting-custom-fixed-point-formats">Suggesting custom fixed-point formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="#converting-sources-into-a-synthesizable-description">Converting sources into a synthesizable description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#to-do">To Do</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sigrok.html">sigrok-cli | Pulseview</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Open Source Verification Bundle</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
            

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Fixed-point conversion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/umarcor/osvb/blob/master/doc/notebook/fpconv.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fixed-point-conversion">
<span id="osvb-notebook-fpconv"></span><h1>Fixed-point conversion<a class="headerlink" href="#fixed-point-conversion" title="Permalink to this headline">¶</a></h1>
<p>This section contains notes about data type exploration and visualization in arithmetic algorithms/circuits. Approaches based on HDL and programming languages are discussed.</p>
<p>Porting algorithms involving intensive arithmetic pipelines/sequences from a high-level software language to a Hardware Description Language (HDL) is non-trivial. On the one hand, data storage and movement need to be redesigned, in order to make the most of available resources on the target devices. On the other hand, reducing area and power constraints by using custom precision fixed-point data types is a usual strategy.</p>
<p>Traditionally, data type analysis and modeling is done in software. A typical procedure is to:</p>
<ol class="arabic simple">
<li><p>Write an algorithm with double precision.</p></li>
<li><p>Change to single, and compare.</p></li>
<li><p>Do analytical analysis of propagation of error, if possible; otherwise, do experimental analysis.</p></li>
<li><p>Change to custom fixed-point types using some library, and compare.</p></li>
<li><p>Write/generate (V)HDL with <cite>std_logic_vector</cite>, <cite>unsigned</cite> and/or <cite>signed</cite>, and compare.</p></li>
</ol>
<p>Multiple tools/frameworks/languages provide features for modelling fixed-point data types in step 4 (e.g. <a class="reference external" href="https://rig.readthedocs.io/en/stable/ten_lines/type_casts_doctest.html">rig</a> on <a class="reference external" href="https://www.python.org/">Python</a>, <a class="reference external" href="https://octave.sourceforge.io/octave/function/fixed_point_format.html">fixed_point_format</a> on <a class="reference external" href="https://www.gnu.org/software/octave/">Octave</a>, or <a class="reference external" href="https://docs.rs/fixed/0.4.4/fixed/">fixed</a> on <a class="reference external" href="https://www.rust-lang.org">Rust</a>, or <a class="reference external" href="https://github.com/shopspring/decimal">shopspring/decimal</a> on <a class="reference external" href="https://golang.org/">golang</a>). However, none of the mentioned resources was originally designed for modelling fixed-point circuits, even less <em>custom</em> types. Furthermore, the structure/layout of software sources can be significantly different from hardware description sources. As a result, users/developers need to duplicate the effort for avoiding mismatches between simulation models and circuit descriptions.</p>
<p>Several HDL generation tools avoid effort duplication by <em>allowing</em> developers not to write HDL (step 5). This is the case of <a class="reference external" href="https://www.xilinx.com">Xilinx</a>’s <a class="reference external" href="https://www.xilinx.com/products/design-tools/vivado/integration/esl-design.html">Vivado HLS</a> and <a class="reference external" href="https://www.xilinx.com/products/design-tools/vitis.html">Vitis</a>, <a class="reference external" href="http://www.myhdl.org/">MyHDL</a> or <a class="reference external" href="https://m-labs.hk/gateware/migen/">migen</a>, among others. For example, <a class="reference external" href="https://www.mathworks.com">MathWorks</a>’ <a class="reference external" href="https://www.mathworks.com/products/matlab.html">MATLAB</a> and <a class="reference external" href="https://www.mathworks.com/products/simulink.html">Simulink</a> provide multiple features to do so:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://mathworks.com/products/fixed-point-designer.html">mathworks.com/products/fixed-point-designer</a></p></li>
<li><p><a class="reference external" href="https://mathworks.com/videos/data-type-exploration-and-visualization-of-signal-ranges-1506620567017.html">https://mathworks.com/videos/data-type-exploration-and-visualization-of-signal-ranges-1506620567017.html</a></p></li>
<li><p><a class="reference external" href="https://mathworks.com/help/fixedpoint">mathworks.com/help/fixedpoint</a></p>
<ul>
<li><p><a class="reference external" href="https://mathworks.com/help/fixedpoint/ref/numerictypescope.html">ref/numerictypescope.html</a></p></li>
<li><p><a class="reference external" href="https://mathworks.com/help/fixedpoint/ug/configuring-blocks-with-fixed-point-output.html">ug/configuring-blocks-with-fixed-point-output.html</a></p></li>
<li><p><a class="reference external" href="https://mathworks.com/help/fixedpoint/ug/fixed-point-conversion.html">ug/fixed-point-conversion.html</a></p></li>
</ul>
</li>
</ul>
<p>MathWorks’ is a comprehensive solution that allows users to run target functions/designs with multiple data sets and to gather statistics about the value of each variable (step 3). Then, it suggests lower precision datatypes automatically. It allows to customize them and to test them iteratively (step 4). Custom data types or arbitrary sizes and with various encondings are supported (see <a class="reference external" href="https://es.mathworks.com/help/fixedpoint/ref/embedded.fimath.html">fimath</a>). Overall, it’s a very effective solution when used along with <a class="reference external" href="https://www.mathworks.com/products/matlab-coder.html">Coder</a> and/or <a class="reference external" href="https://www.mathworks.com/products/hdl-coder.html">HDL Coder</a> (step 5).</p>
<p>However, using higher-level HDL generators comes with its own caveats, such as being constrained by unidiomatic constructs or not being able to customize/optimize lower level details. Users familiar with VHDL (or who are otherwise targeting FPGA or ASIC designs) might find using VHDL early in the algorithmic refinement process to be a suitable alternative. VHDL’s strong type system (inherited from Ada) and the inherent concurrency in the language provide powerful features for building complex models.</p>
<p>Since VHDL 2008, IEEE libraries (distributed along with the IEEE 1076 standard) include generic fixed-point and floating-point packages that allow to define custom data types and rounding/truncation/resizing strategies. Furthermore, since December 2019 those libraries are open source: <a class="reference external" href="https://opensource.ieee.org/vasg/Packages">opensource.ieee.org/vasg/Packages</a>. For backwards compatibility, the original proponent’s (David W. Bishop’s) VHDL 1993 versions are available at <a class="reference external" href="https://github.com/FPHDL/fphdl">FPHDL/fphdl</a>.</p>
<p>Performance-wise, simulation of VHDL designs can be significantly slower than executing other (software) languages. Fortunately, <a class="reference external" href="https://github.com/ghdl/ghdl">GHDL</a> is a <em>libre</em> and <em>gratis</em> tool, which runs on multiple platforms (architectures and OSs), and allows to generate executable machine code. The generated code can be executed standalone or co-executed with sources written in a <em>foreign</em> language (see <a class="reference external" href="https://ghdl.github.io/ghdl-cosim/">ghdl.github.io/ghdl-cosim</a>).</p>
<p>This section gathers strategies and code examples about using VHDL and GHDL for getting statistics from variables/signals in algorithms written using a higher abstraction level VHDL style (step 3). The purpose is to replace step 2 with porting the code to VHDL. Then, do steps 3 and 4 with VHDL, and rewrite step 5 as <em>“converting non-synthesizable sources into a synthesizable description</em>”.</p>
<div class="section" id="initial-code-porting">
<h2>Initial code porting<a class="headerlink" href="#initial-code-porting" title="Permalink to this headline">¶</a></h2>
<p>Although modern VHDL allows writing sources using high abstraction features, those are commonly disregarded when the language is taught, or even by practitioners. This is mostly because some (or many) of the higher level features are either not synthesizable or not supported by synthesis or simulation tools yet. Moreover, for testing and verification purposes, SystemVerilog and UVM seem to take the lead (see <a class="reference external" href="https://larsasplund.github.io/github-facts/">larsasplund.github.io/github-facts</a>).</p>
<p>Nevertheless, many algorithms in fields such as Digital Signal Processing (DSP), image processing or machine-learning are (or can be) formulated as <em>basic</em> vector or matrix operations. These operations can be described with nested for loops and built-in operators (<cite>+</cite>, <cite>-</cite>, <cite>*</cite>, <cite>/</cite>, <cite>**</cite>), using a coding style similar to Ada or C. For example:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
  <span class="k">subtype</span> <span class="n">vec_t</span> <span class="k">is</span> <span class="n">real_vector</span><span class="p">(</span><span class="mi">0</span> <span class="k">to</span> <span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">type</span> <span class="n">mat_t</span> <span class="k">is</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span> <span class="k">to</span> <span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">of</span> <span class="n">vec_t</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="k">process</span>
    <span class="k">variable</span> <span class="n">m</span><span class="o">:</span> <span class="n">mat_t</span><span class="p">;</span>
    <span class="k">variable</span> <span class="n">q</span><span class="o">:</span> <span class="n">vec_t</span><span class="p">;</span>
  <span class="k">begin</span>
<span class="p">...</span>
    <span class="k">for</span> <span class="n">j</span> <span class="k">in</span> <span class="n">m</span><span class="na">&#39;range</span> <span class="k">loop</span>
      <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">q</span><span class="na">&#39;range</span> <span class="k">loop</span>
        <span class="n">q</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">:=</span> <span class="n">q</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">(</span><span class="n">j</span><span class="p">)(</span><span class="n">i</span><span class="p">)</span> <span class="k">when</span> <span class="n">f</span> <span class="k">else</span> <span class="n">q</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">m</span><span class="p">(</span><span class="n">j</span><span class="p">)(</span><span class="n">i</span><span class="p">);</span>
      <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Reading/writing data to/from binary files in VHDL is also similar to other languages:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
  <span class="k">type</span> <span class="n">REAL_BIN</span> <span class="k">is</span> <span class="k">file</span> <span class="k">of</span> <span class="n">real</span><span class="p">;</span>
  <span class="k">file</span> <span class="n">fptr</span> <span class="o">:</span> <span class="n">REAL_BIN</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="k">process</span>
    <span class="k">variable</span> <span class="n">sts</span> <span class="o">:</span> <span class="kt">FILE_OPEN_STATUS</span><span class="p">;</span>
    <span class="k">variable</span> <span class="n">m</span><span class="o">:</span> <span class="n">mat_t</span><span class="p">;</span>
    <span class="k">variable</span> <span class="n">q</span><span class="o">:</span> <span class="n">vec_t</span><span class="p">;</span>
  <span class="k">begin</span>
    <span class="n">file_open</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span> <span class="n">fptr</span><span class="p">,</span> <span class="s">&quot;path/to/input.bin&quot;</span><span class="p">,</span> <span class="n">read_mode</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">j</span> <span class="k">in</span> <span class="n">m</span><span class="na">&#39;range</span> <span class="k">loop</span>
      <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">q</span><span class="na">&#39;range</span> <span class="k">loop</span>
        <span class="n">read</span><span class="p">(</span><span class="n">fptr</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">j</span><span class="p">)(</span><span class="n">i</span><span class="p">));</span>
      <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
    <span class="n">file_close</span><span class="p">(</span><span class="n">fptr</span><span class="p">);</span>
<span class="p">...</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/Paebbels/JSON-for-VHDL">JSON-for-VHDL</a> is an alternative for more complex data structures.</p>
<p>Regarding language support, GHDL and some other commercial simulators support enough from VHDL 2008 for using generic packages and other features that facilitate code reuse. Unfortunately, most commercial simulator licenses do not allow to disclose whether features are supported. Hence, users need to check the documentation or test the features themselves.</p>
<p>Note that rewriting the algorithm in VHDL using <cite>real</cite> data type should not involve any accuracy penalty compared to the equivalent code in C or m using <cite>double</cite>.</p>
</div>
<div class="section" id="getting-simulation-data">
<h2>Getting simulation data<a class="headerlink" href="#getting-simulation-data" title="Permalink to this headline">¶</a></h2>
<p>After the algorithm is ported to VHDL and it is validated, analysis of error with reduced precision can be done. Sometimes, it is possible to obtain a model of propagation of error analytically. Often, an experimental approach is followed instead. Assuming availability of enough test data, the algorithm can be simulated to obtain a table that shows the specific values that each signal/variable was assigned, and how many times was each value used.</p>
<div class="section" id="waveform-dumps">
<h3>Waveform dumps<a class="headerlink" href="#waveform-dumps" title="Permalink to this headline">¶</a></h3>
<p>Fortunately, registering all the values that each signal is assigned is a built-in feature in most HDL simulators. Precisely, waveforms are dumped to formats such as VCD or GHW. Hence, a possible approach for getting all the values that a signal was assigned is to post-process waveform dumps.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GHDL allows filtering which signals are dumped (see <a class="reference external" href="https://ghdl.github.io/ghdl/using/Simulation.html#cmdoption-ghdl-read-wave-opt" title="(in GHDL v2.0.0-dev)"><code class="xref std std-option docutils literal notranslate"><span class="pre">--read-wave-opt</span></code></a>). This allows reducing the size of the dumps by providing the list of signals to be analyzed only.</p>
</div>
</div>
<div class="section" id="vcd-parser">
<h3>vcd_parser<a class="headerlink" href="#vcd-parser" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/GordonMcGregor/vcd_parser">GordonMcGregor/vcd_parser</a> is a VCD parser that walks through a waveform and allows to set watchers that react when named signals change. In 2018, it was forked and updated to be compatible with Python 3: <a class="reference external" href="https://github.com/wohali/vcd_parsealyze">wohali/vcd_parsealyze</a>. However, neither GordonMcGregor’s nor whoali’s latest versions seem to handle getting values of multi-bit signals. <a class="reference external" href="https://github.com/umarcor/vcd_parsealyze">umarcor/vcd_parsealyze</a> is a fork of the latter, where reading signals of type <cite>real</cite> or <cite>integer</cite> is supported. <a class="reference external" href="https://github.com/umarcor/vcd_parsealyze/blob/master/examples/fpconv.py">fpconv.py</a> is an example that watches a clock signal and saves the values of <cite>real</cite> and <cite>integer</cite> signals at each rising edge. At the end, the table of each signal is saved to a separate tab-delimited CSV file.</p>
<p>Currently, reading frequency tables of <cite>real</cite> signals on other tools, such as MATLAB, works as expected. However, integers are dumped by GHDL as arrays of bits preprended with <cite>b</cite> (32 bits if negative, <cite>&lt;=32</cite> bits if positive). These are not properly read by other tools yet. A future enhancement is to sign-extend them before using Python’s <cite>eval</cite>, for convert strings to an integer.</p>
</div>
<div class="section" id="ghdl">
<h3>GHDL<a class="headerlink" href="#ghdl" title="Permalink to this headline">¶</a></h3>
<p>GHDL produces waveform dumps in multiple formats. Hence, its codebase contains the required logic for achieving the desired purpose. However, it is not intuitive how to get the name and value of the signals that are being dumped: <a class="reference external" href="https://github.com/ghdl/ghdl/blob/master/src/grt/grt-waves.adb#L1781-L1783">ghdl/ghdl · src/grt/grt-waves.adb#L1781-L1783</a>.</p>
<div class="section" id="gtkwave">
<h4>GtkWave<a class="headerlink" href="#gtkwave" title="Permalink to this headline">¶</a></h4>
<p>By the same token, GtkWave contains C sources that allow reading the waveform formats generated by GHDL. However, those are not meant to be used as a toolkit (see <a class="reference external" href="https://github.com/gtkwave/gtkwave/issues/9">gtkwave/gtkwave#9</a>).</p>
<p>Nevertheless, showing an histogram or table of frequencies might be a handy enhancement to GtkWave’s GUI featuresm, for interacting with fixed-point signals.</p>
</div>
<div class="section" id="sigrok-pulseview">
<h4>sigrok/PulseView<a class="headerlink" href="#sigrok-pulseview" title="Permalink to this headline">¶</a></h4>
<p>Although PulseView has some performance issues with waveforms generated by GHDL (see <a class="reference internal" href="sigrok.html#osvb-notebook-sigrok"><span class="std std-ref">sigrok-cli | Pulseview</span></a>), the work-in-progress VCD parse module of <a class="reference external" href="https://github.com/sigrokproject/libsigrok">libsigrok</a> might have enough features for achieving the desired purpose. However, <cite>libsigrok</cite>’s internal structure cannot handle multi-bit signals.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The interface based on watchers and trackers of <cite>vcd_parsealyze</cite> is very similar to PulseView’s concept of protocol analyzers.</p>
</div>
</div>
<div class="section" id="dwfv">
<h4>dwfv<a class="headerlink" href="#dwfv" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://github.com/psurply/dwfv">psurply/dwfv</a> is “<em>a simple digital waveform viewer (in the therminal) with vi-like key binding</em>” written in Rust. It exposes a backend API to facilitate manipulation of signals in Rust and it provides <cite>–stats</cite> through the CLI interface. See <a class="reference external" href="https://github.com/psurply/dwfv/issues/8">psurply/dwfv#8</a>.</p>
</div>
</div>
<div class="section" id="vhdl-component-module">
<h3>VHDL component/module<a class="headerlink" href="#vhdl-component-module" title="Permalink to this headline">¶</a></h3>
<p>Instead of using the waveform dumping features provided by simulators, a more granular dumping of signal values is possible through a reusable VHDL component. For example:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">m_stats</span><span class="o">:</span> <span class="k">entity</span> <span class="nc">pkg_name</span><span class="p">.</span><span class="n">stats_monitor</span>
  <span class="k">generic</span> <span class="k">map</span> <span class="p">(</span>
    <span class="n">target</span> <span class="o">=&gt;</span> <span class="s">&quot;path/to/output/file&quot;</span>
  <span class="p">)</span>
  <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
    <span class="n">CLK</span> <span class="o">=&gt;</span> <span class="n">clk</span><span class="p">,</span>
    <span class="n">DATA</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
  <span class="p">);</span>

<span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">;</span>
</pre></div>
</div>
<p>The module can be implemented with multiple architectures, for generating different output formats (CSV, binary, HEX, etc.). A package can provide “dynamically sized arrays of reals” (similar to <a class="reference external" href="https://github.com/VUnit/vunit/blob/master/vunit/vhdl/data_types/src/integer_array_pkg.vhd">VUnit’s integer_array_pkg</a>). Alternatively, VPI/VHPI/VHPIDIRECT can be used to pass data through an access/pointer (see <a class="reference external" href="https://ghdl.github.io/ghdl-cosim/index.html">ghdl.github.io/ghdl-cosim</a>) by wrapping GHDL in a foreign language.</p>
<p>The disadvantage of this approach is that additional VHDL code needs to be included in the sources. On the other hand, it allows to more easily decide which time frames to record and to ignore values under certain conditions.</p>
<p>This approach is similar to the AXI monitors that are available in <a class="reference external" href="https://github.com/VUnit">VUnit</a> or <a class="reference external" href="https://github.com/OSVVM">OSVVM</a>. The difference is how the content is interpreted. In AXI monitors, the protocol is checked. In this use case, a table is filled.</p>
</div>
<div class="section" id="simulation-verification-frameworks">
<h3>Simulation/verification frameworks<a class="headerlink" href="#simulation-verification-frameworks" title="Permalink to this headline">¶</a></h3>
<p>cocotb uses VPI or VHPI interfaces for interacting with simulators at runtime. It allows to look/watch a hierarchical HDL path (as done in <cite>vcd_parsealyze</cite>). However, reading nested records and arrays in GHDL through VPI is work in progress yet (see <a class="reference external" href="https://github.com/ghdl/ghdl/pull/1249">ghdl/ghdl#1249</a>).</p>
<p>Analogously, MyHDL allows deriving from the <cite>Signal</cite> class and adding custom hooks/rules. However, MyHDL’s purpose is describing circuits in Python and optionally generating HDL sources.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ktbarrett/bv2/tree/vector-2">Potential replacement for BinaryValue as seen in cocotb</a></p></li>
</ul>
</div>
</div>
<div class="section" id="analyzing-simulation-statistics">
<h2>Analyzing simulation statistics<a class="headerlink" href="#analyzing-simulation-statistics" title="Permalink to this headline">¶</a></h2>
<p>The table of frequencies generated for each recorded signal can be post-processed for generating the histogram in any language with a plot/graph library (Python, Matlab, Octave, D3.js…).</p>
</div>
<div class="section" id="suggesting-custom-fixed-point-formats">
<h2>Suggesting custom fixed-point formats<a class="headerlink" href="#suggesting-custom-fixed-point-formats" title="Permalink to this headline">¶</a></h2>
<p>Suggesting optimal word size and fractional lengths automatically is out-of-scope of this project. However, contributions of alternatives to MATLAB’s <cite>numerictypescope</cite> that generate an interactive interface are welcome!</p>
<p>Regarding usage of custom types in VHDL, <a class="reference external" href="https://github.com/FPHDL/fphdl/blob/master/Fixed_ug.pdf">FPHDL · Fixed_ug.pdf</a> and <a class="reference external" href="https://github.com/FPHDL/fphdl/blob/master/Float_ug.pdf">FPHDL · Float_ug.pdf</a> are the guides of VHDL’s packages for defining custom fixed/float types. Users familiar with MATLAB’s <cite>fimath</cite> will find definition of formats/types and truncation/rounding/overflow strategies to be almost equivalent.</p>
</div>
<div class="section" id="converting-sources-into-a-synthesizable-description">
<h2>Converting sources into a synthesizable description<a class="headerlink" href="#converting-sources-into-a-synthesizable-description" title="Permalink to this headline">¶</a></h2>
<p>Apart from simulation, GHDL has experimental support for synthesis too (see <a class="reference external" href="https://ghdl.github.io/ghdl/using/Synthesis.html#using-synthesis" title="(in GHDL v2.0.0-dev)"><span>Synthesis</span></a>). Hence, after converting data types to fixed-point types (or in parallel with doing it), VHDL sources can be reshaped to properly describe the structure of the circuit. During the process, <cite>ghdl –synth</cite> can be used as a check. When passing, the output of GHDL (which is a VHDL 1993 netlist) can be used in vendor tools (e.g. Vivado). Alternatively, formal verification is possible through <a class="reference external" href="https://github.com/ghdl/ghdl-yosys-plugin">ghdl-yosys-plugin</a>, which plugs GHDL into the open source ecosystem composed by <a class="reference external" href="https://github.com/YosysHQ/yosys">yosys</a>, <a class="reference external" href="https://github.com/YosysHQ/nextpnr">nextpnr</a>, <a class="reference external" href="https://github.com/YosysHQ/SymbiYosys">Symbiyosys</a>, etc.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/umarcor/vcd_parsealyze/tree/master/examples/ghdl">umarcor/vcd_parsealyze · examples/ghdl</a> produces a VCD file to test <a class="reference external" href="https://github.com/umarcor/vcd_parsealyze/blob/master/examples/fpconv.py">fpconv.py</a>.</p></li>
<li><p>Example <a class="reference external" href="https://ghdl.github.io/ghdl-cosim/vhpidirect/examples/arrays.html#array-and-axi4-stream-verification-components">Array and AXI4 Stream Verification Components</a> from <a class="reference external" href="https://ghdl.github.io/ghdl-cosim">ghdl.github.io/ghdl-cosim</a> shows how to read data of type <cite>real</cite> (C’s <cite>double</cite>) and convert it to/from custom signed fixed-point data types.</p></li>
</ul>
</div>
<div class="section" id="to-do">
<h2>To Do<a class="headerlink" href="#to-do" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/smlgit/fpbinary">smlgit/fpbinary</a>, a binary fixed point library for Python.</p></li>
<li><p><a class="reference external" href="https://github.com/francof2a/fxpmath">francof2a/fxpmath</a>, a Python library for fractional fixed-point (base 2) arithmetic and binary manipulation with Numpy compatibility.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sigrok.html" class="btn btn-neutral float-right" title="sigrok-cli | Pulseview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../egs/axi4stream.html" class="btn btn-neutral float-left" title="SISO AXI4 Stream" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Unai Martinez-Corral and contributors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/buildthedocs/sphinx.theme">theme</a>
    
    provided by <a href="https://buildthedocs.github.io">Build the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>